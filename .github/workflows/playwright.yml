name: Playwright Tests
on:
  workflow_dispatch

jobs:
  test:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [16, 18]  # Adjust Node.js versions as needed
        browser: [chromium, firefox, webkit]  # Playwright browser variants
        environment: [staging, production]  # Example environments
    env:
      # Dynamic environment variables
      privateBaseUrl: https://noodle:OrecchiettE2022@staging-linguinelawschool-farfallelawfirm.noodle.com
      # You can further adjust these environment URLs based on the environment matrix value
      environmentBaseUrl: https://noodle:OrecchiettE2022@${{ matrix.environment }}-linguinelawschool-farfallelawfirm.noodle.com
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}

      - name: Install dependencies
        run: |
          npm ci  # Use 'npm install' if you don't use a lock file

      - name: Install Playwright Browsers
        run: |
          npx playwright install --with-deps  # Install the necessary browsers

      - name: Run Playwright Tests
        run: |
          echo "Running tests on ${{ matrix.browser }} for environment ${{ matrix.environment }}"
          npx playwright test guest-cart-desktop-private-test.spec.ts --headed --project=${{ matrix.browser }} --base-url=${{ env.environmentBaseUrl }}
        env:
          # Override any specific environment variables needed for the test
          PRIVATE_BASE_URL: ${{ env.environmentBaseUrl }}
          ENVIRONMENT: ${{ matrix.environment }}
